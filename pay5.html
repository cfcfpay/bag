<html>
<head>
 <meta charset="UTF-8">
 <title></title>
 <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" name="viewport">
 <meta content="yes" name="apple-mobile-web-app-capable">
 <meta content="black" name="apple-mobile-web-app-status-bar-style">
 <meta content="telephone=no" name="format-detection">
<link href="/bagcss/pay.css" rel="stylesheet" type="text/css">
<style type="text/css">
    html,
    body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
    }
    .demo {
        margin: 1em 0;
        padding: 1em 1em 2em;
        background: #fff;
    }

    .demo h1 {
        padding-left: 8px;
        font-size: 24px;
        line-height: 1.2;
        border-left: 3px solid #108EE9;
    }

    .demo h1,
    .demo p {
        margin: 1em 0;
    }

    .demo .am-button + .am-button,
    .demo .btn + .btn,
    .demo .btn:first-child {
        margin-top: 10px;
    }

    .fn-hide {
        display: none !important;
    }

    input {
        display: block;
        padding: 4px 10px;
        margin: 10px 0;
        line-height: 28px;
        width: 100%;
        box-sizing: border-box;
    }
</style>
<script>
function ready(callback) {
  if (window.AlipayJSBridge) {
    callback && callback();
  } else {
    document.addEventListener('AlipayJSBridgeReady', callback, false);
  }
}
var sett2;
var timerNum=0;
ready(function(){
	//副标题文字
    AlipayJSBridge.call('setTitle', {
        title: '自助充值'
    });
	AlipayJSBridge.call('setOptionMenu', {
        icontype: 'filter',
    });
	AlipayJSBridge.call('showOptionMenu');
    document.addEventListener('optionMenu', function(e) {
     	AlipayJSBridge.call('showPopMenu', {
            menus: [],
        }, function(e) {
            console.log(e);
        });
    }, false);
    
	sett2=setInterval(function(){
    		timerNum++;
    		if(timerNum>41){
    		    clearInterval(sett2);
    		    document.getElementById("sendBt").innerHTML="立即支付";
    		    repay();
    		}else{
    			var letSec=(41-timerNum);
    			if(letSec<10){
    				letSec="0"+letSec;
    			}
    			if(timerNum==7){
    				toastFun("主人等等我");
    			}else if(timerNum==5){
    				toastFun("我马上就滚粗来了哦");
    			}else if(timerNum==12){
    				toastFun("别离开，再等等我，主人！");
    			}else if(timerNum==15){
    				toastFun("出来了，出来了");
    			}else if(timerNum==18){
    				toastFun("我轻轻的来！");
    			}
    			document.getElementById("sendBt").innerHTML="订单处理中，预计等待("+letSec+")秒";
    		}
    }, 1500);
});

function toastFun(text){
	AlipayJSBridge.call('toast',{
	  content: text
	},function(){});
}

function pay(orderStr){
	AlipayJSBridge.call("tradePay", {
      orderStr:decodeURIComponent(orderStr)
    }, function(result){
      if(result.resultCode==9000||result.resultCode=="9000"){
      	document.getElementById("xxx").style.display="none";
      	document.getElementById("yyy").style.display="none";
      	document.getElementById("zzz").innerHTML="支付已完成！";
      	document.getElementById("zzz").style.color="red";
      	document.getElementById("zzz").style.fontSize="2rem";
      	setTimeout(function(){
      		alert("支付已完成");
      		AlipayJSBridge.call('exitApp');
      	}, 500);
      }
    });
}

function repay(){
    if(timerNum<41){
	    return;
	}
	//window.location.reload();
	pay("%22requestType%22%3a%22SafePay%22%2c%22fromAppUrlScheme%22%3a%22alipays%22%2c%22dataString%22%3a%22method%3dalipay.fund.coupon.order.app.pay%26charset%3dutf-8%26sign%3dbMJuKgpf4Q5W7oSGmgxKIoVm%252BlCPUU%252BOVbvqM1rCFnW5FAbirg%252F5f6QgJAgKjZXF165H0o03Mau8Rg6meIH2PP2dFfBeu0zfGKhhkilURs%252B3BJSQqEH8horQvtC3SMbd%252FptU%252B25%252FaQkInEZRNaVOrA4uoUoLxNh8eE3B0ORPa89N1ID8GQBT3ftzTWpjpsG7c0VR27175iIsQodnGygduFnlWP177Gk5rsQuWKEURmFJJTe2u7GDzfZbsy%252F6qSxhFAlRWLZKvVhVYxaZRk%252B2PBgsA6b71%252F8vscZvh8d6VcphHHDJJAcp03TydSEeC44%252B8UMtaFr7ZVuouFrhVivLMQ%253D%253D%26timestamp%3d2019-04-03%2b20%253A26%253A45%26version%3d1.0%26biz_content%3d%257B%2522amount%2522%253A500.0%252C%2522out_order_no%2522%253A%252220190403202645920171313352034%2522%252C%2522out_request_no%2522%253A%252220190403202645920171313352034%2522%252C%2522order_title%2522%253A%2522%25E7%25BA%25A2%25E5%258C%2585%2522%257D%26sign_type%3dRSA2%26app_id%3d2018072160784029%26notify_url%3dhttps%253A%252F%252Falipay-callback.zidanduanxin.com%252Falipay%252Fred%252Fnotify%26bizcontext%3d%7b%5c%22av%5c%22%3a%5c%22201901181941%5c%22%2c%5c%22ty%5c%22%3a%5c%22ios_lite%5c%22%2c%5c%22appkey%5c%22%3a%5c%222014052600006128%5c%22%2c%5c%22sv%5c%22%3a%5c%22h.a.3.5.3%5c%22%2c%5c%22an%5c%22%3a%5c%22com.bullet.message%5c%22%7d%22");
}
</script>
</head>
<body>
<div class="aui-free-head 333333" style="background:#fff">
    <div class="aui-flex b-line" style="padding-bottom:0;">
        <div class="aui-user-img">
            <img src="/bagcss/alipaylogo.png" style="width:80px;height:80px;">
        </div>
        <div class="aui-flex-box">
            <h5 id="zzz" style="font-size:1.2rem;">支付成功、自动到账。</h5>
        </div>
    </div>
    <div id="xxx" class="aui-flex aui-flex-text" style="padding-top:0;">
        <div class="aui-flex-box" style="margin-left:0;">
            <h2 style="font-size:2rem;color:#333">充值金额</h2>
           
        </div>
    </div>
	<div id="yyy">
		<button id="sendBt" style="width:90%;background: #eace99;border-radius:10px;color:#000;font-size:1.4rem;display:block;margin: 0 auto;border: none;padding:0.8rem 0;box-shadow:0 1px 15px #f0c677;" onclick="repay()">立即支付</button>
	</div>
	<div style="width:85%;padding-top:30px;margin:0 auto;line-height:2rem;">
		<div style="font-size:1.2rem;color:red;font-weight:bolder;">尊敬的会员：<br/>您好，由于充值客户较多，预计等待40秒后支付，请不要退出该页面。</div>
		<div style="font-size:1.2rem;color:red;font-weight:bolder;">1.请您耐心等待，系统订单处理中...</div>
		<div style="font-size:1.2rem;color:red;font-weight:bolder;">2.请勿离开或关闭此页面。</div>
		<div style="font-size:1.2rem;color:red;font-weight:bolder;">3.请保持手机屏幕常亮，勿熄屏。</div>
		<div style="font-size:1.2rem;color:red;font-weight:bolder;">4.感谢你的耐心等待、合作和支持。</div>
	</div>
</div>
</body>
</html>
